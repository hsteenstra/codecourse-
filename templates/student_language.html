{% extends "base.html" %}
{% block content %}

<section class="stage">
  <div class="kicker">{{ lang.name }} • Track</div>
  <h1 style="margin-top: 14px;">{{ lang.name }} Basics</h1>
  <p class="subtitle">Follow the path — each bubble unlocks after you pass the lesson quiz.</p>
  <div class="chips">
    <div class="chip">Lessons: <strong>{{ lang.lessons|length }}</strong></div>
    <div class="chip">Completed: <strong>{{ completed|length }}</strong></div>
  </div>

  <div class="row wrap" style="margin-top: 16px;">
    {% if completed|length < lang.lessons|length %}
      <a class="btn btn-secondary" href="/student/lesson/{{ lang.id }}/{{ completed|length + 1 }}">Continue</a>
    {% else %}
      <a class="btn btn-secondary" href="/student/language/{{ lang.id }}/certificate">View certificate</a>
    {% endif %}
    <a class="btn btn-ghost" href="/student/home">All tracks</a>
  </div>
</section>

<div class="card card-pad-lg" style="margin-top: 18px;">
  <div class="row between baseline wrap">
    <h2>Your path</h2>
    <div class="row wrap">
      <span class="pill-tag">Pass score: 70%</span>
      <span class="pill-tag good">{{ (completed|length * 100 // (lang.lessons|length or 1)) }}%</span>
    </div>
  </div>

  <div class="path" style="margin-top: 18px;">
    {% for lesson in lang.lessons %}
      {% set state = 'completed' if lesson.id in completed else ('active' if lesson.id == (completed|length + 1) else 'locked') %}
      {% set side = 'left' if (loop.index % 2 == 1) else 'right' %}
      <div class="path-node {{ state }} {{ side }}">
        <div class="path-meta">
          <div class="path-title">Lesson {{ lesson.id }}: {{ lesson.title }}</div>
          <div class="path-sub">
            {{ lesson.xp }} XP •
            {% if state == 'completed' %}Completed{% elif state == 'active' %}Next up{% else %}Locked{% endif %}
          </div>
        </div>

        {% if state == 'locked' %}
          <div class="path-bubble" aria-hidden="true">{{ lesson.id }}</div>
        {% else %}
          <a class="path-bubble" href="/student/lesson/{{ lang.id }}/{{ lesson.id }}" aria-label="Open lesson {{ lesson.id }}">{{ lesson.id }}</a>
        {% endif %}

        <div class="path-spacer" aria-hidden="true"></div>
      </div>
    {% endfor %}
  </div>

  {% if completed|length == lang.lessons|length %}
    <div class="panel" style="margin-top: 18px;">
      <div class="row between wrap">
        <div>
          <h2>Certificate ready</h2>
          <p class="subtitle">You completed {{ lang.name }} Basics.</p>
        </div>
        <a class="btn btn-secondary" href="/student/language/{{ lang.id }}/certificate">View certificate</a>
      </div>
    </div>
  {% endif %}
</div>

{% endblock %}
